<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: radial-gradient(at top left, #e0eafc, #cfdef3); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: #fff; padding: 40px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .icon-circle { width: 60px; height: 60px; background: rgba(79, 70, 229, 0.1); color: #4f46e5; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; }
        .tag { font-size: 24px; font-weight: 600; margin-bottom: 8px; }
        .subtitle { color: #666; font-size: 14px; margin-bottom: 25px; }
        .input-group { margin-bottom: 20px; text-align: left; }
        label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 8px; }
        input { width: 100%; padding: 14px; border: 1.5px solid #eee; border-radius: 8px; background: #f9f9f9; font-size: 15px; }
        .reset-btn { width: 100%; padding: 14px; background: #1a1a1a; color: #fff; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .step { display: none; } .step.active { display: block; }
        .error { color: #ef4444; font-size: 12px; margin-top: 5px; }
        #otpInput { text-align: center; letter-spacing: 8px; font-weight: 700; font-size: 20px; }
        
        /* Success Animation */
        .check-container { display: none; width: 80px; height: 80px; border-radius: 50%; border: 4px solid #10b981; margin: 0 auto 20px; position: relative; }
        .check-container::after { content: ''; position: absolute; top: 15px; left: 10px; width: 30px; height: 50px; border-right: 4px solid #10b981; border-bottom: 4px solid #10b981; transform: rotate(45deg); animation: check 0.5s ease forwards; }
        @keyframes check { from { width: 0; height: 0; } to { width: 30px; height: 50px; } }
    </style>
</head>
<body>
    <div class="container">
        <div id="step1" class="step active">
            <div class="icon-circle"><i data-lucide="mail"></i></div>
            <h1 class="tag">Forgot Password</h1>
            <p class="subtitle">Enter your email for a verification code.</p>
            <div class="input-group"><input type="email" id="emailInput" placeholder="name@example.com"><p id="err1" class="error"></p></div>
            <button class="reset-btn" onclick="requestOTP()">Send Code</button>
        </div>

        <div id="step2" class="step">
            <div class="icon-circle"><i data-lucide="shield-check"></i></div>
            <h1 class="tag">Verify OTP</h1>
            <p class="subtitle">Code sent to your Gmail.</p>
            <div class="input-group">
                <input type="text" id="otpInput" maxlength="6">
                <div style="display:flex; justify-content:space-between; margin-top:8px;">
                    <p id="err2" class="error"></p>
                    <p id="timer" style="font-size:12px; color:#4f46e5; font-weight:600;">05:00</p>
                </div>
            </div>
            <button class="reset-btn" onclick="verifyOTP()">Verify</button>
        </div>

        <div id="step3" class="step">
            <div class="icon-circle"><i data-lucide="lock"></i></div>
            <h1 class="tag">New Password</h1>
            <div class="input-group"><input type="password" id="newPass" placeholder="••••••••"><p id="err3" class="error"></p></div>
            <button class="reset-btn" onclick="resetPassword()">Update</button>
        </div>

        <div id="step4" class="step">
            <div class="check-container" style="display:block;"></div>
            <h1 class="tag">Done!</h1>
            <p class="subtitle">Password updated successfully.</p>
            <button class="reset-btn" onclick="window.location.href='/index.html'">Login Now</button>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let email = "", otp = "", timer;

        function showStep(n) { document.querySelectorAll('.step').forEach(s => s.classList.remove('active')); document.getElementById(`step${n}`).classList.add('active'); lucide.createIcons(); }

        function startTimer() {
            let t = 300; clearInterval(timer);
            timer = setInterval(() => {
                let m = Math.floor(t/60), s = t%60;
                document.getElementById('timer').innerText = `${m}:${s<10?'0':''}${s}`;
                if(--t < 0) clearInterval(timer);
            }, 1000);
        }

        async function requestOTP() {
            email = document.getElementById('emailInput').value;
            const res = await fetch('/forgot-password/request', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email}) });
            const data = await res.json();
            if(data.success) { showStep(2); startTimer(); } else document.getElementById('err1').innerText = data.message;
        }

        async function verifyOTP() {
            otp = document.getElementById('otpInput').value;
            const res = await fetch('/forgot-password/verify', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, otp}) });
            if((await res.json()).success) showStep(3); else document.getElementById('err2').innerText = "Wrong Code";
        }

        async function resetPassword() {
            const newPassword = document.getElementById('newPass').value;
            const res = await fetch('/forgot-password/reset', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, otp, newPassword}) });
            if((await res.json()).success) showStep(4); else document.getElementById('err3').innerText = "Update Failed";
        }
    </script>
</body>
</html>